/* Copyright (c) 2008 Kean Loong Tan
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * Copyright notice and license must remain intact for legal use
 * jTree 1.0 - Modified
 */
(function($){$.fn.jTree=function(options){$("body").append('<ul id="jTreeHelper"></ul>');var opts=$.extend({},$.fn.jTree.defaults,options);var cur=0,curOff=0,off=0,h=0,w=0,hover=0;var str='<li class="jTreePlacement"></li>';var container=this;$(this).find(opts.clickHandle).mousedown(function(e){if($("#jTreeHelper").is(":not(:animated)")&&e.button!=2){$("body").css("cursor","move").append(str);$(".jTreePlacement").hide();$(this).parents('li:first').each(function(){if(this.tagName=='LI'){cur=$(this)}});$(cur).clone().appendTo("#jTreeHelper");curOff=$(cur).offset();$(cur).hide();$("#jTreeHelper").css({position:"absolute",top:e.pageY+5,left:e.pageX+5,opacity:opts.hOpacity}).hide();if(opts.showHelper)$("#jTreeHelper").show();$(document).bind("selectstart",doNothing);$(container).find(opts.clickHandle).bind("dblclick",doNothing);$(container).find("li").bind("mouseover",getInitial);$(container).bind("mousemove",sibOrChild);$(container).find("li").bind("mousemove",putPlacement);$(document).bind("mousemove",helperPosition)}return false});$(this).find(opts.clickHandle).andSelf().mouseup(function(e){if(cur!=0){$("body").css("cursor","default");if($(".jTreePlacement").is(":visible")){$(cur).insertBefore(".jTreePlacement").show();if(opts.callback!=''){opts.callback.apply()}}$(cur).show();$(container).find("ul:empty").remove();$("#jTreeHelper").empty().hide();$(".jTreePlacement").remove();destroyBindings()}return false});$(document).mouseup(function(e){$("body").css("cursor","default");if($("#jTreeHelper").is(":not(:empty)")){$("#jTreeHelper").animate({top:curOff.top,left:curOff.left},opts.snapBack,function(){$("#jTreeHelper").empty().hide();$(".jTreePlacement").remove();$(cur).show()});destroyBindings()}return false});var doNothing=function(){return false};var destroyBindings=function(){$(document).unbind("selectstart",doNothing);$(container).find(opts.clickHandle).unbind("dblclick",doNothing);$(container).find("li").unbind("mouseover",getInitial);$(container).find("li").unbind("mousemove",putPlacement);$(document).unbind("mousemove",helperPosition);$(container).unbind("mousemove",sibOrChild);return false};var helperPosition=function(e){$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});$(".jTreePlacement").remove();return false};var getInitial=function(e){off=$(this).offset();h=$(this).height();w=$(this).width();hover=this;return false};var sibOrChild=function(e){$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});return false};var putPlacement=function(e){$("#jTreeHelper").css({top:e.pageY+5,left:e.pageX+5});if(e.pageY>=off.top&&e.pageY<(off.top+h/2-1)){if(!$(this).prev().hasClass("jTreePlacement")){$(".jTreePlacement").remove();$(this).before(str)}}else if(e.pageY>(off.top+h/2)&&e.pageY<=(off.top+h)){if(e.pageX>off.left&&e.pageX<off.left+opts.childOff){if(!$(this).next().hasClass("jTreePlacement")){$(".jTreePlacement").remove();$(this).after(str)}}else if(e.pageX>off.left+opts.childOff){$(".jTreePlacement").remove();if($(this).find("ul").length==0)$(this).append('<ul>'+str+'</ul>');else $(this).find("ul").prepend(str)}}if($(".jTreePlacement").length>1)$(".jTreePlacement:first-child").remove();return false}};$.fn.jTree.defaults={showHelper:true,clickHandle:".drag",hOpacity:0.5,hBg:"#fcc",hColor:"#222",pBorder:"1px solid #ccc",pBg:"#eee",pColor:"#222",pHeight:"20px",childOff:35,snapBack:1000,callback:""}})(jQuery);